{% for message in messages %}
<div class="group flex hover:bg-gray-50 dark:hover:bg-gray-800 -mx-6 px-6 py-2 transition-colors relative">
    <div class="flex-shrink-0 mr-3">
        <div class="w-9 h-9 rounded bg-slack-purple flex items-center justify-center text-white font-bold text-sm">
            {{ message.username[:1].upper() }}
        </div>
    </div>
    <div class="flex-1 min-w-0">
        <div class="flex items-baseline">
            <span class="font-bold text-gray-900 dark:text-white mr-2">{{ message.username }}</span>
            <span class="text-xs text-gray-500 dark:text-gray-400">
                {{ message.created_at.strftime('%H:%M') if message.created_at else '' }}
            </span>
        </div>
        <div class="text-gray-800 dark:text-gray-200 break-words leading-relaxed">
            {{ message.text }}
            {% if message.is_edited %}
            <span class="text-xs text-gray-400 ml-1">(ç·¨é›†æ¸ˆã¿)</span>
            {% endif %}
        </div>
        {% set uncomfortable_count = message.report_counts.get('uncomfortable', 0) %}
        {% set harassment_count = message.report_counts.get('harassment_suspected', 0) %}
        <div class="mt-2 flex items-center gap-2 text-xs text-gray-600 dark:text-gray-400">
            <button 
                class="flex items-center gap-1 px-2 py-1 rounded border border-gray-200 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed"
                hx-post="/messages/{{ message.id }}/report"
                hx-vals='{"label": "uncomfortable"}'
                hx-target="#messages-container"
                hx-swap="innerHTML"
                {% if message.user_report_label %}disabled{% endif %}>
                <span>ğŸ˜• ä¸å¿«</span>
                <span class="text-[11px] text-gray-500">{{ uncomfortable_count }}</span>
            </button>
            <button 
                class="flex items-center gap-1 px-2 py-1 rounded border border-gray-200 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed"
                hx-post="/messages/{{ message.id }}/report"
                hx-vals='{"label": "harassment_suspected"}'
                hx-target="#messages-container"
                hx-swap="innerHTML"
                {% if message.user_report_label %}disabled{% endif %}>
                <span>âš ï¸ ãƒãƒ©ã‚¹ãƒ¡ãƒ³ãƒˆã‹ã‚‚</span>
                <span class="text-[11px] text-gray-500">{{ harassment_count }}</span>
            </button>
            {% if message.user_report_label %}
            <span class="text-[11px] text-gray-500">
                å ±å‘Šæ¸ˆã¿: {{ "ä¸å¿«" if message.user_report_label == "uncomfortable" else "ãƒãƒ©ã‚¹ãƒ¡ãƒ³ãƒˆã®å¯èƒ½æ€§" }}
            </span>
            {% endif %}
        </div>
    </div>
    
    <!-- Hover Actions -->
    {% if user.id == message.user_id %}
    <div class="absolute right-4 top-2 hidden group-hover:flex bg-white dark:bg-gray-700 shadow-sm border border-gray-200 dark:border-gray-600 rounded overflow-hidden">
        <button class="p-1 hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-500">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path></svg>
        </button>
        <button class="p-1 hover:bg-gray-100 dark:hover:bg-gray-600 text-red-500"
                hx-delete="/channels/{{ channel_id }}/messages/{{ message.id }}"
                hx-confirm="æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ"
                hx-target="#messages-container"
                hx-swap="innerHTML">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
        </button>
    </div>
    {% endif %}
</div>
{% else %}
<div class="text-center text-gray-500 dark:text-gray-400 py-8">
    <p>ã¾ã ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚æœ€åˆã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æŠ•ç¨¿ã—ã¾ã—ã‚‡ã†ï¼</p>
</div>
{% endfor %}
